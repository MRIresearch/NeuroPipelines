Bootstrap: docker
From: ubuntu:xenial

%help
Singularity container with MRtrix 3.0 RC3

Please refer to https://github.com/MRIresearch/NeuroPipelines/blob/master/containers/nklab-mrtrix/README.md for more information about this container.


%setup
cp ./src/startup.sh $SINGULARITY_ROOTFS
cp ./src/readme $SINGULARITY_ROOTFS
cp ./src/version $SINGULARITY_ROOTFS

%environment
export LC_ALL=en_US.UTF-8
export PATH=/opt/mrtrix3/bin:$PATH
export PATH=/opt/bin:$PATH

%files

%runscript
cd /opt/data
exec /opt/bin/startup.sh "$@"

%test

%post
mkdir -p /uaopt /extra /xdisk /rsgrps /opt/data /opt/bin /opt/work /opt/input /opt/output /cm/shared /cm/local /opt/config

export DEBIAN_FRONTEND=noninteractive
export TZ=America/Phoenix
ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

apt-get update

apt-get install -y \
locales 

echo "LC_ALL=en_US.UTF-8" >> /etc/environment
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf
locale-gen en_US.UTF-8
export LC_ALL=en_US.UTF-8

apt-get install -y \
	nano \
	apt-utils \
	wget \
	curl \
        dc \
	lsb-core \
        python \
        git \
        g++ \
        libeigen3-dev \
        zlib1g-dev \
        libqt4-opengl-dev \
        libgl1-mesa-dev \
        libfftw3-dev 


cd /tmp        
apt purge -y python-pip
apt purge -y python3-pip
curl https://bootstrap.pypa.io/get-pip.py -o /tmp/get-pip.py
python get-pip.py
python3 get-pip.py

pip install numpy==1.16.0

cd /opt
git clone https://github.com/MRtrix3/mrtrix3.git
cd /opt/mrtrix3
git checkout 3.0_RC3
./configure
./build


#install libraries for QGTKstyle and Libcanberra  issues
apt-get install -y libgnomeui-0
apt-get install -y libcanberra-gtk0

chmod -R 777 /opt

mv /startup.sh /opt/bin
mv /readme /opt/bin
mv /version /opt/bin
